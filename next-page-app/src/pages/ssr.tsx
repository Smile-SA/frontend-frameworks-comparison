import { GetServerSideProps, InferGetServerSidePropsType } from "next";
import Head from "next/head";

import AsyncHomepage, { IData } from "@/components/AsyncHomepage";
import DynamicLayout from "@/layouts/DynamicLayout";

export default function Ssr({
  data,
}: InferGetServerSidePropsType<typeof getServerSideProps>) {
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
          rel="icon"
          type="image/vnd.microsoft.icon"
          href="http://localhost:3333/favicon.ico"
        />
      </Head>
      <DynamicLayout>
        <AsyncHomepage data={data} />
      </DynamicLayout>
    </>
  );
}

export const getServerSideProps: GetServerSideProps<{
  data: IData;
}> = async () => {
  const [cards, openSources, solutions, technologies] = await Promise.all([
    fetch("http://localhost:3333/cards").then((r) => r.json()),
    fetch("http://localhost:3333/opensource").then((r) => r.json()),
    fetch("http://localhost:3333/solutions").then((r) => r.json()),
    fetch("http://localhost:3333/technologies").then((r) => r.json()),
  ]);
  const data: IData = {
    cards,
    openSources,
    solutions,
    technologies,
  };
  return { props: { data } };
};
